<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MathGenius - Multi-Grade Math Tutor</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Comic+Neue:wght@700&display=swap" rel="stylesheet">
    <style>
        :root {
            --neon-blue: #0ff0fc;
            --neon-pink: #ff2ced;
            --neon-green: #00ff88;
            --neon-yellow: #fff01f;
            --neon-purple: #9d00ff;
            --glow: 0 0 10px;
        }
        
        body {
            margin: 0;
            padding: 0;
            font-family: 'Comic Neue', cursive;
            background: #000 url('https://i.imgur.com/8YQcY92.jpg') no-repeat center center fixed;
            background-size: cover;
            color: white;
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        /* LED Grid Background */
        .led-grid {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle, rgba(0,255,136,0.05) 1px, transparent 1px),
                radial-gradient(circle, rgba(15,240,252,0.05) 1px, transparent 1px),
                radial-gradient(circle, rgba(255,44,237,0.05) 1px, transparent 1px);
            background-size: 50px 50px;
            z-index: -2;
            animation: gridPulse 10s infinite alternate;
        }
        
        @keyframes gridPulse {
            0% { opacity: 0.3; }
            100% { opacity: 0.7; }
        }
        
        /* Grade Selection Screen */
        .grade-selector {
            max-width: 800px;
            margin: 50px auto;
            text-align: center;
            animation: fadeIn 1s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .grade-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 3rem;
            color: var(--neon-yellow);
            text-shadow: 0 0 10px var(--neon-yellow);
            margin-bottom: 30px;
        }
        
        .grade-options {
            display: flex;
            justify-content: center;
            gap: 30px;
            flex-wrap: wrap;
        }
        
        .grade-card {
            background: rgba(20, 20, 50, 0.8);
            border: 3px solid var(--neon-blue);
            border-radius: 15px;
            padding: 30px;
            width: 200px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 0 20px rgba(15, 240, 252, 0.3);
        }
        
        .grade-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 0 30px var(--neon-blue);
            border-color: var(--neon-pink);
        }
        
        .grade-card h3 {
            color: var(--neon-green);
            font-size: 1.5rem;
            margin-top: 0;
        }
        
        .grade-card p {
            color: #ccc;
        }
        
        /* Main Tutor Container (now hidden initially) */
        .math-tutor {
            display: none;
            max-width: 900px;
            margin: 20px auto;
            padding: 30px;
            background: rgba(10, 10, 30, 0.9);
            border: 4px solid var(--neon-blue);
            border-radius: 20px;
            box-shadow: 
                0 0 30px var(--neon-blue),
                inset 0 0 20px var(--neon-blue);
            position: relative;
            animation: fadeIn 0.5s;
        }
        
        /* ... (keep all previous CSS styles from earlier version) ... */
    </style>
</head>
<body>
    <!-- LED Grid Background -->
    <div class="led-grid"></div>
    
    <!-- Grade Level Selection Screen -->
    <div class="grade-selector" id="grade-selector">
        <h1 class="grade-title">Choose Your Math Level</h1>
        <div class="grade-options">
            <div class="grade-card" data-grade="elementary">
                <h3>Elementary School</h3>
                <p>Grades 1-5</p>
                <p>Addition, Subtraction, Multiplication</p>
            </div>
            <div class="grade-card" data-grade="middle">
                <h3>Middle School</h3>
                <p>Grades 6-8</p>
                <p>Pre-Algebra, Geometry, Ratios</p>
            </div>
            <div class="grade-card" data-grade="high">
                <h3>High School</h3>
                <p>Grades 9-12</p>
                <p>Algebra, Calculus, Trigonometry</p>
            </div>
        </div>
    </div>
    
    <!-- Main Tutor Container (hidden initially) -->
    <div class="math-tutor" id="math-tutor">
        <!-- ... (keep all previous HTML from earlier version) ... -->
    </div>
    
    <!-- Celebration Effects -->
    <div class="celebration" id="celebration"></div>
    <div class="level-up" id="level-up">LEVEL UP!</div>
    
    <script>
        // ======================
        // ENHANCED MATH TUTOR ENGINE
        // ======================
        
        // Massive Question Database by Grade Level
        const mathProblems = {
            elementary: {
                addition: [
                    { question: "5 + 3 = ▢", answer: 8, hint: "Count up from 5!" },
                    // ... (keep all elementary problems from earlier)
                ],
                subtraction: [
                    // ... elementary subtraction
                ],
                // ... other elementary categories
            },
            
            middle: {
                preAlgebra: [
                    { question: "x + 3 = 9, x = ▢", answer: 6, hint: "Subtract 3 from both sides" },
                    { question: "2x = 16, x = ▢", answer: 8, hint: "Divide both sides by 2" },
                    { question: "x - 7 = 15, x = ▢", answer: 22, hint: "Add 7 to both sides" },
                    { question: "3x + 5 = 20, x = ▢", answer: 5, hint: "First subtract 5, then divide by 3" },
                    { question: "2(x - 3) = 10, x = ▢", answer: 8, hint: "First divide both sides by 2" }
                ],
                geometry: [
                    { question: "Area of 5×8 rectangle = ▢", answer: 40, hint: "Area = length × width" },
                    { question: "Perimeter of 6×9 rectangle = ▢", answer: 30, hint: "Add all four sides" },
                    { question: "Right triangle sides 5,12,▢", answer: 13, hint: "Pythagorean theorem" },
                    { question: "Circle diameter=10, radius=▢", answer: 5, hint: "Radius is half of diameter" },
                    { question: "Angles in quadrilateral add to ▢°", answer: 360, hint: "All 4-sided shapes" }
                ],
                ratios: [
                    { question: "Simplify 15:25", answer: "3:5", hint: "Divide both by greatest common factor" },
                    { question: "If 3 pencils cost $1.20, 5 pencils cost $▢", answer: "2.00", hint: "Find cost per pencil first" },
                    { question: "Map scale 1in:10mi, 3in = ▢mi", answer: 30, hint: "Multiply by scale factor" },
                    { question: "Recipe needs 2c flour for 24 cookies. For 60 cookies, ▢c flour", answer: 5, hint: "Find ratio per cookie" },
                    { question: "Class has 18 girls and 12 boys. Girl:boy ratio = ▢", answer: "3:2", hint: "Simplify the fraction" }
                ]
            },
            
            high: {
                algebra: [
                    { question: "Solve x² - 9 = 0", answer: "3,-3", hint: "Factor as (x+3)(x-3)=0" },
                    { question: "Factor x² + 5x + 6", answer: "(x+2)(x+3)", hint: "Find two numbers that multiply to 6 and add to 5" },
                    { question: "Solve |2x - 5| = 7", answer: "6,-1", hint: "Create two equations" },
                    { question: "Simplify (3x³)²", answer: "9x⁶", hint: "Square both coefficient and exponent" },
                    { question: "Solve √(x + 3) = 5", answer: 22, hint: "Square both sides first" }
                ],
                calculus: [
                    { question: "Derivative of 3x⁴", answer: "12x³", hint: "Multiply coefficient by exponent, reduce exponent by 1" },
                    { question: "∫(2x + 1) dx from 0 to 2", answer: 6, hint: "Find antiderivative then evaluate" },
                    { question: "f'(x) if f(x) = sin(2x)", answer: "2cos(2x)", hint: "Chain rule" },
                    { question: "lim_(x→3) (x² - 9)/(x - 3)", answer: 6, hint: "Factor numerator" },
                    { question: "dy/dx for y = ln(x²)", answer: "2/x", hint: "Chain rule + derivative of ln" }
                ],
                trigonometry: [
                    { question: "sin(30°) = ▢", answer: "0.5", hint: "Special triangle ratio" },
                    { question: "cos(π/3) = ▢", answer: "0.5", hint: "π/3 radians = 60 degrees" },
                    { question: "tan(45°) = ▢", answer: "1", hint: "Opposite/adjacent in 45-45-90 triangle" },
                    { question: "Convert 150° to radians", answer: "5π/6", hint: "Multiply by π/180" },
                    { question: "Period of y = sin(2x)", answer: "π", hint: "2π divided by coefficient" }
                ]
            }
        };

        // Game State
        let currentGrade = '';
        let currentCategory = '';
        let currentProblem = 0;
        let score = 0;
        let attempts = 0;
        let level = 1;
        let problemsAnswered = 0;
        let totalProblems = 0;

        // DOM Elements
        const gradeSelector = document.getElementById('grade-selector');
        const mathTutor = document.getElementById('math-tutor');
        const gradeCards = document.querySelectorAll('.grade-card');
        // ... (keep other DOM elements from earlier)

        // Event Listeners for Grade Selection
        gradeCards.forEach(card => {
            card.addEventListener('click', function() {
                currentGrade = this.getAttribute('data-grade');
                startGradeLevel(currentGrade);
            });
        });

        // Start Selected Grade Level
        function startGradeLevel(grade) {
            currentGrade = grade;
            gradeSelector.style.display = 'none';
            mathTutor.style.display = 'block';
            
            // Set first category based on grade
            if (grade === 'elementary') {
                currentCategory = 'addition';
            } else if (grade === 'middle') {
                currentCategory = 'preAlgebra';
            } else {
                currentCategory = 'algebra';
            }
            
            // Calculate total problems for progress tracking
            totalProblems = Object.values(mathProblems[currentGrade])
                .reduce((sum, cat) => sum + cat.length, 0);
            
            // Start first problem
            displayProblem();
            showFeedback(`Welcome to ${grade} math! Let's begin!`);
        }

        // ... (keep all other functions from earlier, but they'll now use currentGrade) ...

        // Example modified displayProblem function:
        function displayProblem() {
            const categoryProblems = mathProblems[currentGrade][currentCategory];
            problemText.textContent = categoryProblems[currentProblem].question;
            // ... rest of the function remains same
        }

        // Modified nextProblem function to handle category switching:
        function nextProblem() {
            problemContainer.classList.remove('correct');
            
            currentProblem++;
            const categoryProblems = mathProblems[currentGrade][currentCategory];
            
            if (currentProblem >= categoryProblems.length) {
                // Move to next category
                const categories = Object.keys(mathProblems[currentGrade]);
                const currentIndex = categories.indexOf(currentCategory);
                
                if (currentIndex < categories.length - 1) {
                    currentCategory = categories[currentIndex + 1];
                    currentProblem = 0;
                    showFeedback(`Great job! Now let's try ${currentCategory} problems!`);
                } else {
                    // All categories completed
                    problemText.innerHTML = `You completed all ${currentGrade} math problems!<br>Final Score: ${score} correct!`;
                    // ... rest of completion logic
                    return;
                }
            }
            
            displayProblem();
        }

        // ... (keep all other existing functions) ...
    </script>
</body>
</html>
