<script>
    // Track current unit
    let currentUnit = 'basic-arithmetic';
    
    // Show selected grade level
    function showGrade(grade) {
        document.getElementById('elementary').style.display = 'none';
        document.getElementById('middle').style.display = 'none';
        document.getElementById('high').style.display = 'none';
        document.getElementById(grade).style.display = 'grid';
        localStorage.setItem('lastGrade', grade);
    }
    
    // Start a unit
    function startUnit(unitId) {
        currentUnit = unitId;
        document.getElementById('elementary').style.display = 'none';
        document.getElementById('middle').style.display = 'none';
        document.getElementById('high').style.display = 'none';
        
        // Set up problem based on unit
        const problemData = getProblemData(unitId);
        document.getElementById('problem-unit-title').textContent = problemData.unitTitle;
        document.getElementById('problem-text').innerHTML = `<p>${problemData.problem}</p>`;
        document.getElementById('answer-input').value = '';
        document.getElementById('feedback').style.display = 'none';
        document.getElementById('teacher-explanation').style.display = 'none';
        
        document.getElementById('problem-section').style.display = 'block';
        window.scrollTo(0, 0);
    }
    
    // Return to unit selection
    function backToUnits() {
        document.getElementById('problem-section').style.display = 'none';
        const lastGrade = localStorage.getItem('lastGrade') || 'elementary';
        document.getElementById(lastGrade).style.display = 'grid';
    }
    
    // Check student's answer
    function checkAnswer() {
        const userAnswer = document.getElementById('answer-input').value.trim();
        const problemData = getProblemData(currentUnit);
        const feedback = document.getElementById('feedback');
        const explanation = document.getElementById('teacher-explanation');
        
        // For fractions, accept multiple forms (like 5/4 or 1 1/4)
        let isCorrect = false;
        if (currentUnit.includes('fraction') || currentUnit.includes('arithmetic')) {
            isCorrect = problemData.acceptableAnswers.includes(userAnswer.toLowerCase());
        } else {
            isCorrect = userAnswer.toLowerCase() === problemData.answer.toLowerCase();
        }
        
        if (isCorrect) {
            feedback.innerHTML = `
                <div class="correct-feedback">
                    <p><i class="fas fa-check-circle"></i> <strong>Correct!</strong> Great job!</p>
                    <p>${problemData.correctFeedback}</p>
                </div>
            `;
        } else {
            feedback.innerHTML = `
                <div class="incorrect-feedback">
                    <p><i class="fas fa-exclamation-circle"></i> <strong>Not quite right</strong>, but that's okay!</p>
                    <p>The correct answer is: ${problemData.answer}</p>
                </div>
            `;
            
            // Show detailed explanation
            document.getElementById('explanation-content').innerHTML = problemData.explanation;
            document.getElementById('teacher-tip-content').innerHTML = problemData.tip;
            
            // Show step-by-step solution
            let stepsHtml = '<h4><i class="fas fa-list-ol"></i> Step-by-Step Solution:</h4>';
            problemData.steps.forEach((step, index) => {
                stepsHtml += `
                    <div class="step">
                        <div class="step-number">${index + 1}</div>
                        <div>${step}</div>
                    </div>
                `;
            });
            document.getElementById('step-by-step').innerHTML = stepsHtml;
            
            explanation.style.display = 'block';
        }
        
        feedback.style.display = 'block';
    }
    
    // Get problem data based on unit
    function getProblemData(unitId) {
        const problems = {
            'basic-arithmetic': {
                unitTitle: 'Basic Arithmetic',
                problem: 'What is 3/4 + 1/2? Remember to find a common denominator first.',
                answer: '5/4',
                acceptableAnswers: ['5/4', '1 1/4', '1.25', '1¼'],
                correctFeedback: 'You correctly found the common denominator and added the numerators!',
                explanation: '<p>When adding fractions, we need a common denominator. Here\'s how to solve it:</p>',
                tip: 'Remember that the denominator tells us how many equal parts make a whole. We can\'t add fractions directly unless they have the same denominator.',
                steps: [
                    'Find a common denominator: The denominators are 4 and 2. The least common denominator is 4.',
                    'Convert 1/2 to fourths: 1/2 = 2/4',
                    'Now add: 3/4 + 2/4 = 5/4',
                    'Simplify if needed: 5/4 can be written as 1 1/4'
                ]
            },
            'fractions': {
                unitTitle: 'Fractions',
                problem: 'Multiply 2/3 × 3/5. Simplify your answer if possible.',
                answer: '2/5',
                acceptableAnswers: ['6/15', '2/5', '0.4'],
                correctFeedback: 'Excellent work multiplying the numerators and denominators!',
                explanation: '<p>Multiplying fractions is different from adding them. Here\'s the process:</p>',
                tip: 'Unlike addition, we don\'t need a common denominator for multiplication. Just multiply straight across!',
                steps: [
                    'Multiply the numerators: 2 × 3 = 6',
                    'Multiply the denominators: 3 × 5 = 15',
                    'This gives us 6/15',
                    'Simplify by dividing numerator and denominator by 3: 6 ÷ 3 = 2, 15 ÷ 3 = 5',
                    'Final simplified answer: 2/5'
                ]
            },
            'pre-algebra': {
                unitTitle: 'Pre-Algebra',
                problem: 'Solve for x: 2x + 5 = 15',
                answer: '5',
                acceptableAnswers: ['5', '5.0'],
                correctFeedback: 'Great job isolating the variable!',
                explanation: '<p>Solving linear equations requires careful step-by-step work:</p>',
                tip: 'Think of the equation like a balance scale - whatever you do to one side, you must do to the other.',
                steps: [
                    'Start with the equation: 2x + 5 = 15',
                    'Subtract 5 from both sides: 2x = 10',
                    'Divide both sides by 2: x = 5',
                    'Check your answer by plugging back in: 2(5) + 5 = 15 ✓'
                ]
            },
            'algebra': {
                unitTitle: 'Algebra',
                problem: 'Solve for x: x² - 5x + 6 = 0',
                answer: '2, 3',
                acceptableAnswers: ['2,3', '3,2', '2 and 3', '3 and 2', 'x=2,x=3', 'x=3,x=2'],
                correctFeedback: 'Excellent work factoring the quadratic equation!',
                explanation: '<p>Quadratic equations can be solved by factoring:</p>',
                tip: 'Look for two numbers that multiply to the constant term (6) and add to the coefficient of the middle term (-5).',
                steps: [
                    'Factor the quadratic: (x - 2)(x - 3) = 0',
                    'Set each factor equal to zero: x - 2 = 0 or x - 3 = 0',
                    'Solve each equation: x = 2 or x = 3'
                ]
            }
        };
        
        return problems[unitId] || problems['basic-arithmetic'];
    }
    
    // Initialize with elementary content
    document.addEventListener('DOMContentLoaded', function() {
        showGrade('elementary');
    });
</script>
